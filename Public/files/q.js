
(function(){var cacheUrl={};function _load_js(url,cb,charset,attr,opts){var node,connectId=genHash(url),onload,tmp,doc=document,head;head=doc.head||doc.getElementsByTagName("head")[0]||doc.body;opts=opts||{};fnQueue.add(connectId,cb);if(cacheUrl[connectId]&&cacheUrl[connectId]<0){return;}
if(cacheUrl[connectId]&&cacheUrl[connectId]>0){fnQueue.execOnce(connectId);return;}
cacheUrl[connectId]=-1;node=doc.createElement("script");node.id='_gdt_loader_'+Math.random();node.setAttribute("data-name",connectId);charset=charset||'UTF-8';if(cb){onload=function(){var v=this.readyState;if(typeof v==='undefined'||"loaded"===v||"complete"===v){cacheUrl[connectId]=1;node.onload=node.onreadystatechange=null;head.removeChild(node);node=null;fnQueue.execOnce(connectId);}};node.onreadystatechange=onload;node.onload=onload;}
node.type='text/javascript';node.charset=charset;if(attr){for(var t in attr){if(typeof(tmp=attr[t])=="string"&&t.toLowerCase()!="src"){node.setAttribute(k,tmp);}}}
node.src=url;head.appendChild(node);}
function genHash(str){var hash=5381;str=str||'';for(var i=0,len=str.length;i<len;++i){hash+=(hash<<5)+str.charAt(i).charCodeAt();}
return hash&0x7fffffff;}
var slice=Array.prototype.slice;var loading=false,fnQueue;fnQueue={fnlist:{},exec:function(key){var fn,len,i,queue=fnQueue.fnlist[key]||[],args=slice.call(arguments,1);len=queue.length;for(i=0;i<len;i++){fn=queue[i];fn.apply(null,args);}},execOnce:function(key){var queue;fnQueue.exec(key);fnQueue.fnlist[key]=[];},add:function(key,cb){!fnQueue.fnlist[key]&&(fnQueue.fnlist[key]=[]);fnQueue.fnlist[key].push(cb);}};var GDT={importJs:_load_js,getType:function(obj){return obj===null?'null':(obj===undefined?'undefined':Object.prototype.toString.call(obj).slice(8,-1).toLowerCase());},genIframe:function(w,h){var ifr,doc=document;w=w||0;h=h||0;ifr=doc.createElement('iframe');ifr.width=w;ifr.height=h;ifr.scrolling='no';ifr.setAttribute('frameBorder','0');ifr.setAttribute('marginHeight','0');ifr.setAttribute('marginWidth','0');ifr.setAttribute('allowTransparency',true);ifr.style.cssText='position:static !important;display:block !important;margin:0 !important;padding:0 !important;visibility:visible !important;float:none !important;border-width:0 !important;width:'+w+'px !important;height:'+h+'px !important';return ifr;},getRenderedCount:function(){var count=0,ifrs,doc=document,configUrl=this.config.url,ul=configUrl.length;ifrs=(doc.body||doc.documentElement).getElementsByTagName('iframe');for(var i=0,len=ifrs.length;i<len;i++){if(ifrs[i].src.substring(0,ul)==configUrl){count++;}}
return count;},render:function(pageConfig){var doc=document,slot,renderedCount,cfg,posid,renderCfg,config=this.config,prefix=config.prefix,pidIdx=config.pidIdx,maxcount=config.maxcount,typeIdx=config.typeIdx;pageConfig=pageConfig||[];renderedCount=this.getRenderedCount();for(var i=0,l=pageConfig.length;i<l;i++){var tmpcfg=pageConfig[i];if(GDT.getType(tmpcfg)=='object'){cfg=tmpcfg;}else{cfg={posid:tmpcfg[pidIdx],width:tmpcfg[config.widthIdx],height:tmpcfg[config.heightIdx],type:tmpcfg[typeIdx]};}
posid=cfg.posid;if(!posid){continue;}
slot=doc.getElementById(prefix+posid);if(slot&&renderedCount<maxcount){renderedCount++;slot.id+='_'+renderedCount;renderCfg={posid:posid,width:cfg.width||'',height:cfg.height||'',type:cfg.type||'',pollstyle:cfg.pollstyle,count:renderedCount};for(var j=config.optsTrans.length-1;j>=0;j--){var trans=config.optsTrans[j];cfg[trans]&&(renderCfg[trans]=cfg[trans]);}
if(isNaN(posid)){this.renderZS(slot,renderCfg);}else{this.renderGDT(slot,renderCfg);}}}},renderGDT:function(slot,cfg){var slot,ifr,src,config=this.config,url;if(cfg.type==='tips'){GDT.loadJS('http://qzs.qq.com/qzone/biz/res/tips.js',function(){__GDTNamespance.initTips(slot,cfg,GDT);});}else{ifr=this.genIframe(cfg.width,cfg.height);src=this.getSrc(slot,cfg);ifr.src=src;slot.parentNode.insertBefore(ifr,slot);GDT.sendPV('gdt/'+cfg.posid,1000);}},getSrc:function(slot,cfg){var src,config=this.config;src=(cfg.posid==='576461895587714255'||cfg.posid==='648519489625642191')?config.urlpan:config.url;src+=cfg.posid+'&cur='+(cfg.count-1);src+='&width='+cfg.width+'&height='+cfg.height;src+='&type='+cfg.type;src+='&title='+encodeURIComponent(document.title.slice(0,64));src+='&url='+encodeURIComponent(document.URL.slice(0,512));for(var j=config.optsTrans.length-1;j>=0;j--){var trans=config.optsTrans[j];cfg[trans]&&(src+='&pollstyle='+cfg[trans]);}
if(cfg.posid==='144116292705443118'){src=src.replace(/view2.fcg/,'view.fcg');src+='&count=1';}
return src;},renderZS:function(slot,cfg){var typeMapping,zsid;typeMapping={'graphic':'graphic','couplet':'couplet','video_rb':'video'};zsid=cfg.posid.split('|').pop();this.loadJS('http://j.wit.qq.com/sc/crystal2.js',(function(zsid,width,height,type,slot){return function(){if(typeof crystal2!=='undefined'){var zsDf=document.createDocumentFragment(),zsHolder=document.createElement('script'),zsHolderFinder=document.createElement('input'),insertNode=slot||document.body||document.documentElement,params;zsHolderFinder.type='hidden';zsDf.appendChild(zsHolder);zsDf.appendChild(zsHolderFinder);document.body.appendChild(zsDf);params=!type||type=='graphic'?{id:zsid,width:width,height:height}:{id:zsid,type:type};crystal2.addStaticSlot(params);insertNode.parentNode.insertBefore(zsHolderFinder.previousSibling,insertNode);zsHolderFinder.parentNode.removeChild(zsHolderFinder);}};})(zsid,cfg.width,cfg.height,cfg.type,slot),{insertNode:slot});GDT.sendPV('discuz/zs/'+cfg.posid,1000);},setGlobal:function(key,value){window.TencentGDT[key]=value;},getGlobal:function(key){return window.TencentGDT[key];},loadJS:function(url,callback,opts){var q,insertNode,loadedList,onLoaded;opts=opts||{};charset=opts.charset||'';loadedList=this.getGlobal('loadJS');if(loadedList&&(url in loadedList)){callback();return;}
q=document.createElement("script");if(callback){onLoaded=function(){var loadedList=GDT.getGlobal('loadJS');!loadedList&&(loadedList={});loadedList[url]=1;GDT.setGlobal('loadJS',loadedList);callback();q=null;url=null;};if(window.ActiveXObject){q.onreadystatechange=function(){var v=this.readyState;if("loaded"===v||"complete"===v){onLoaded();onLoaded=null;}};}else{q.onload=onLoaded;}}
q.charset=charset;q.src=url;insertNode=opts.insertNode||(document.getElementsByTagName("head")[0].firstChild);insertNode.parentNode.insertBefore(q,insertNode);},sendPV:function(path,timeout){var _send;_send=function(path){var list,img,t,rdm,rurl,params=[];img=new Image();t=document.referrer.split(/[\?\#]/);t=t[0].split("/");rdm=t[2]||"-";rurl="/"+t.slice(3).join("/");params.push('cc=-&ct=-&java=1&lang=-&pf=-&scl=-&scr=-&tt=-&tz=-8&vs=3.3');params.push('dm=gdt.qq.com');params.push('url=/union/'+path);params.push('rdm='+escape(rdm));params.push('rurl='+escape(rurl));params.push('sds='+Math.random());img.src='http://pingfore.qq.com/pingd?'+params.join('&');list=GDT.getGlobal('sendPV');!list&&(list=[]);list.push(img);GDT.setGlobal('sendPV',list);};if(timeout){setTimeout(function(){_send(path);},timeout);}else{_send(path);}},config:{maxcount:10,prefix:'gdt-',pidIdx:0,widthIdx:1,heightIdx:2,typeIdx:3,optsTrans:['pollstyle'],url:'http://qzs.qq.com/qzone/biz/res/tmpl/vehicle.html#posid=',urlpan:'http://qzs.qq.com/qzone/biz/res/tmpl/gdtpan.html#posid='},init:function(){var pageConfig;if(pageConfig=window.TencentGDT){this.render(pageConfig);}}};GDT.init();})();